<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>S3 generic to calculate a `pkg_ref` field — pkg_ref_cache • riskmetric</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="S3 generic to calculate a `pkg_ref` field — pkg_ref_cache"><meta property="og:description" content="Reactively retrieve and cache `pkg_ref` metadata"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">riskmetric</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/riskmetric.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/extending-riskmetric.html">Extending riskmetric</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/pharmaR/riskmetric/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>S3 generic to calculate a `pkg_ref` field</h1>
    <small class="dont-index">Source: <a href="https://github.com/pharmaR/riskmetric/blob/HEAD/R/pkg_ref_cache.R" class="external-link"><code>R/pkg_ref_cache.R</code></a></small>
    <div class="hidden name"><code>riskmetric_metadata_caching.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Reactively retrieve and cache `pkg_ref` metadata</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pkg_ref_cache</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">...</span>, .class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a package reference object</p></dd>


<dt>name</dt>
<dd><p>the name of the field that needs to be cached</p></dd>


<dt>...</dt>
<dd><p>additional arguments used for computing cached values</p></dd>


<dt>.class</dt>
<dd><p>a class name to use for S3 dispatch, defaulting to the name as
a character value</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a <code>pkg_ref</code> field</p>


<p>a value to assign to the new field in the package reference object
  environment</p>
    </div>
    <div id="caching-details">
    <h2>Caching Details</h2>
    

<div class="section">
<h3 id="pkg-ref-class-fields"><code>pkg_ref</code> class fields<a class="anchor" aria-label="anchor" href="#pkg-ref-class-fields"></a></h3>
<p>The <code>pkg_ref</code> class structures an environment with special handling
  for indexing into the <code>pkg_ref</code> class using the <code>$</code> or <code>[[</code>
  operators. For all intents and purposes, the <code>pkg_ref</code> class is works
  conceptually similar to a lazy, immutable <code>list</code>, and uses the
  <code>pkg_ref_cache</code> function internally to lazily retrieve package
  reference fields.</p>
</div>
<div class="section">
<h3 id="lazy-metadata-caching">Lazy metadata caching<a class="anchor" aria-label="anchor" href="#lazy-metadata-caching"></a></h3>
<p>Laziness in a <code>pkg_ref</code> object refers to the delayed evaluation of the
  contents of its fields. Since some metadata is time or computationally
  intensive to retrieve, and unnessary for some assessments, we want to avoid
  that retrieval until it is needed.</p>
<p>The first time that a field is accessed within a <code>pkg_ref</code> object
  <code>x</code>, a corresponding <code>pkg_ref_cache</code> S3 generic is called. For
  example, when <code>x$description</code> is first accessed, the <code>pkg_ref</code>
  object uses the function <code>pkg_ref_cache.description</code> to attempt to
  retrieve the contents of the corresponding <code>DESCRIPTION</code> file.</p>
<p>Often, the way that this data is collected might be different depending on
  the subclass of the <code>pkg_ref</code>. In the case of the <code>description</code>
  metadata, a reference to a local install might be able to read in a local
  file directly, whereas a reference to a remote source of metadata might
  require first downloading the file. For this reason, many
  <code>pkg_ref_cache.*</code> functions are themselves S3 generics that dispatch
  on the class of the <code>pkg_ref</code> object, allowing for divergent behaviors
  for different source of package metadata.</p>
</div>
<div class="section">
<h3 id="pkg-ref-field-immutability"><code>pkg_ref</code> field immutability<a class="anchor" aria-label="anchor" href="#pkg-ref-field-immutability"></a></h3>
<p>Once a field has been calculated, its value is immutable. This behavior was
  chosen because of the long time frame over which package metadata changes,
  rendering it unnecessary to continually reevaluate fields each time they
  are accesssed.</p>
<p>This means that within an assessment, a given field for a package will only
  ever be calculated once and preserved for downstream use.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other package reference cache: 
<code><a href="pkg_ref_cache.archive_release_dates.html">pkg_ref_cache.archive_release_dates</a>()</code>,
<code><a href="pkg_ref_cache.bug_reports_host.html">pkg_ref_cache.bug_reports_host</a>()</code>,
<code><a href="pkg_ref_cache.bug_reports_url.html">pkg_ref_cache.bug_reports_url</a>()</code>,
<code><a href="pkg_ref_cache.bug_reports.html">pkg_ref_cache.bug_reports</a>()</code>,
<code><a href="pkg_ref_cache.covr_coverage.html">pkg_ref_cache.covr_coverage</a>()</code>,
<code><a href="pkg_ref_cache.description.html">pkg_ref_cache.description</a>()</code>,
<code><a href="pkg_ref_cache.downloads.html">pkg_ref_cache.downloads</a>()</code>,
<code><a href="pkg_ref_cache.expression_coverage.html">pkg_ref_cache.expression_coverage</a>()</code>,
<code><a href="pkg_ref_cache.help_aliases.html">pkg_ref_cache.help_aliases</a>()</code>,
<code><a href="pkg_ref_cache.help.html">pkg_ref_cache.help</a>()</code>,
<code><a href="pkg_ref_cache.license.html">pkg_ref_cache.license</a>()</code>,
<code><a href="pkg_ref_cache.maintainer.html">pkg_ref_cache.maintainer</a>()</code>,
<code><a href="pkg_ref_cache.news_urls.html">pkg_ref_cache.news_urls</a>()</code>,
<code><a href="pkg_ref_cache.news.html">pkg_ref_cache.news</a>()</code>,
<code><a href="pkg_ref_cache.r_cmd_check.html">pkg_ref_cache.r_cmd_check</a>()</code>,
<code><a href="pkg_ref_cache.release_date.html">pkg_ref_cache.release_date</a>()</code>,
<code><a href="pkg_ref_cache.remote_checks.html">pkg_ref_cache.remote_checks</a>()</code>,
<code><a href="pkg_ref_cache.repo_base_url.html">pkg_ref_cache.repo_base_url</a>()</code>,
<code><a href="pkg_ref_cache.source_control_url.html">pkg_ref_cache.source_control_url</a>()</code>,
<code><a href="pkg_ref_cache.tarball_url.html">pkg_ref_cache.tarball_url</a>()</code>,
<code><a href="pkg_ref_cache.vignettes.html">pkg_ref_cache.vignettes</a>()</code>,
<code><a href="pkg_ref_cache.web_html.html">pkg_ref_cache.web_html</a>()</code>,
<code><a href="pkg_ref_cache.web_url.html">pkg_ref_cache.web_url</a>()</code>,
<code><a href="pkg_ref_cache.website_urls.html">pkg_ref_cache.website_urls</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># implementing a new field called "first_letter" that is consistently derived</span></span></span>
<span class="r-in"><span><span class="co"># across all pkg_ref objects:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">pkg_ref_cache.first_letter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">name</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="pkg_ref.html">pkg_ref</a></span><span class="op">(</span><span class="st">"riskmetric"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">$</span><span class="va">first_letter</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># implementing a new field called "subclass_enum" that dispatches on</span></span></span>
<span class="r-in"><span><span class="co"># the subclass of the pkg_ref object:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">pkg_ref_cache.subclass_enum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"pkg_ref_cache.subclass_enum"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">pkg_ref_cache.subclass_enum.pkg_ref</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fl">0</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">pkg_ref_cache.subclass_enum.pkg_install</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">$</span><span class="va">subclass_enum</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by R Validation Hub, Doug Kelkhoff, Marly Gotti, Eli Miller, Kevin K, Yilong Zhang, Eric Milliman, Juliane Manitz.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

